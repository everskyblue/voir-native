"use strict";var ye=Object.defineProperty,be=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var N=(n,t,e)=>t in n?ye(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,m=(n,t)=>{for(var e in t||(t={}))Ce.call(t,e)&&N(n,e,t[e]);if(se)for(var e of se(t))Pe.call(t,e)&&N(n,e,t[e]);return n},V=(n,t)=>be(n,ve(t));var u=(n,t,e)=>N(n,typeof t!="symbol"?t+"":t,e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("tabris");require("string-tocapitalize");function O(n){return new Proxy(n,{apply(e,r,s){return Reflect.construct(e,s)}})}function De(n){const t={get(e,r,s){return Reflect.get(e,r,s)},apply(e,r,s){return typeof e.name=="string"&&typeof e.constructor=="function"?Reflect.construct(e,s):Reflect.apply(null,e,s)}};return new Proxy(n,t)}const xe=tabris.version.toString(),f=/(2\.9)\.*/.test(xe),w=f?tabris.ui.contentView:tabris.contentView;f&&(global.$=function(e,r){return r?new tabris.WidgetCollection(r):w.find(e)},Object.keys(tabris.Widget.prototype.gestures).forEach(t=>{const e="on"+t.toCapitalize();Object.defineProperty(tabris.Widget.prototype,e,{value:function(r){return this.on(t,r)}})}),tabris,Object.defineProperty(tabris.Widget.prototype,"onSelect",{get(){return t=>this.on("select",t)}}));const J={left:0,right:0,top:0,bottom:0},K={top:0,bottom:0},U={right:0,left:0},p={stretch:J,stretchX:U,stretchY:K,centerX:f?0:!0,centerY:f?0:!0};Object.defineProperty(tabris.Widget.prototype,"stretch",{set(n){return this.layoutData=J,!0},get(){return this.layoutData}});Object.defineProperty(tabris.Widget.prototype,"stretchX",{set(n){return this.layoutData=U,!0},get(){return this.layoutData}});Object.defineProperty(tabris.Widget.prototype,"stretchY",{set(n){return this.layoutData=K,!0},get(){return this.layoutData}});const _e=f?tabris.ui.statusBar:tabris.statusBar,Se=f?tabris.ui.navigationBar:tabris.navigationBar,k=f?tabris.ui.drawer:tabris.drawer,ke=f?function(t={}){return"placement"in t&&(t.placementPriority=t.placement==="overflow"?"low":t.placement==="default"?"normal":"high",delete t.placement),"placementChanged"in t&&(t.placementPriorityChanged=t.placementChanged,delete t.placementChanged),new tabris.Action(t)}:tabris.Action,ie=f?class extends tabris.Composite{constructor(e){super(e);u(this,"_initPrevent",!1)}get alignment(){return"alignment"}set alignment(e){this._alignment=e}set layoutData(e){super.layoutData=p[e]}_addChild(e){var r;return e.left=`prev() ${(r=e.left)!=null?r:0}`,e[this._alignment]=0,super._addChild(e)}}:tabris.Row,G=f?class{constructor(t,e){this.target=t,this.event=e}addListener(t){this.target.on(this.event,t)}trigger(t){return this.target.trigger(this.event,t)}}:tabris.Listeners,Oe=f?class{constructor(){}}:tabris.LayoutData;class E{}u(E,"LONG",3e3),u(E,"MEDIUM",2100),u(E,"SHORT",1500);function F(n,t,e){return n.animate({opacity:1},{delay:t!=null?t:0,duration:e,easing:"ease-in"})}function Q(n,t,e){return n.animate({opacity:0},{delay:t,duration:e,easing:"ease-out"})}function ae(n,t,e){return Promise.resolve(F(n,t,300)).then(()=>Promise.resolve(Q(n,e,e)))}class Ae extends o.EventObject{}class ce{constructor(t={}){const e=[];let r,s,i=!1,c=!1,h=!1;const{width:v}=w.bounds,{screenWidth:C}=tabris.device,d=560,g={elevation:24,centerY:p.centerY,padding:10,cornerRadius:5,opacity:0,background:"white",id:"modal-container"};d>C||d>v?Object.assign(g,{left:24,right:24}):Object.assign(g,{width:d});const P=new o.Composite(V(m({},p.stretch),{opacity:1,highlightOnTouch:!1,background:"rgba(0, 0, 0, 0.50)"})).onTap(l=>l.preventDefault()),a=new o.Composite(g).appendTo(P);"title"in t&&a.append(new o.TextView({id:"modal-title",font:"medium 18px",padding:10,left:0,right:0,text:t.title.toCapitalize()}));const b=new o.Composite(m({top:"#modal-title",bottom:"prev()"},p.stretchX)),X=new o.ScrollView({layoutData:p.stretchX,id:"modal_content_scrollable"}).appendTo(b);a.on("boundsChanged",({value:l})=>{const{height:_}=w.bounds;_<l.height&&(a.set(V(m({},g),{height:l.height>_?d-(d>_?20+d-_:0):d>l.height?l.height:d})),b.set(m({},b.layoutData)),X.set(p.stretch))}),Object.defineProperty(this,"setButtonAccept",{configurable:!1,value:l=>(r||(r=ne("accept",l)),r)}),Object.defineProperty(this,"setButtonCancel",{configurable:!1,value:l=>(s||(s=ne("cancel",l)),s)}),Object.defineProperty(this,"addView",{configurable:!1,value:(...l)=>X.append(l)}),Object.defineProperty(this,"show",{configurable:!1,value:()=>{i||(i=!0,a.append(new o.Composite({layoutData:p.stretchX,id:"buttons-modal",bottom:0}).append(e))),(!h||c)&&(h=!0,c=!1,a.append(b),w.append(P),F(a,0,100))}}),Object.defineProperty(this,"removeView",{configurable:!1,value:()=>X.children().dispose()}),Object.defineProperty(this,"removeButtons",{configurable:!1,value:()=>{r=s=null,e.forEach(l=>{l.dispose()})}}),Object.defineProperty(this,"remove",{configurable:!1,value:()=>{c||Q(P,0,250).then(()=>{c=!0,h=!1,P.detach()})}});function ne(l,_){const H=new o.Button({text:_,top:"#modal_content_scrollable",right:"prev()",bottom:0,style:"text"}),re=new G(H,l);return H.on("tap",()=>re.trigger(new Ae)),e.push(H),re}}}let D=[];class j extends E{constructor(e,r){var g,P;super();u(this,"show");u(this,"_message",new o.TextView({textColor:"white",left:0,right:0}));u(this,"_modal",new o.Composite({background:"black",padding:10,cornerRadius:10,bottom:30,opacity:0}).append(this._message));const s="12px",i=20,c=20,h=(P=(g=o.sizeMeasurement)==null?void 0:g.measureTextsSync([{text:e,font:s}]))!=null?P:[{width:-1,height:-1}];f&&this._modal.once("boundsChanged",({target:a,value:{width:b}})=>{b>w.bounds.width&&a.set({left:i,right:c,centerX:void 0})}),h[0].width>w.bounds.width-20?(this._modal.left=i,this._modal.right=c):this._modal.centerX=f?0:!0,this._message.text=e,this._message.font=s,Object.defineProperty(this,"show",{configurable:!1,value:()=>{if(D.length===1&&C(),D.length>0)D.push({element:this._modal,promise:()=>new Promise(a=>{a(d(this._modal))})});else{const a=d(this._modal);D.push({promise:()=>a,element:this._modal})}}});const C=()=>{if(D.length===0)return;const{promise:a,element:b}=D[0];a().then(()=>{D.shift(),b.dispose(),C()}).catch(console.log)};function d(a){return w.append(a),ae(a,0,r)}}static makeText(e,r=j.SHORT){return new j(e,r)}}const $=new Map;function Ve(n){return n instanceof Object&&n.constructor?n.constructor:n}function le(n){return $.get(Ve(n))}S.addListener=(n,t,e)=>{const{store:r}=le(n);r.has(n)||r.set(n,{event:{},listeners:new WeakMap}),r.get(n).event[t]=e};S.listener=(n,t)=>{const{instanceOf:e,store:r}=le(n);for(let{listeners:s,element:i,invoke:c}of e){if(!(t instanceof i))continue;const h=r.get(n);h&&(h.listeners.has(t)||h.listeners.set(t,s.map(v=>{const C=new G(t,v);return C.addListener(d=>{for(let g of c)h.event[g](d.target,d)}),C})))}};function S(n,t){$.has(n)||$.set(n,V(m({},t),{store:new WeakMap}))}class Z extends o.Composite{constructor(t){super({id:t,top:"prev()",right:0,left:0,height:56,highlightOnTouch:!0})}}class I extends ie{constructor(e){super({layoutData:"stretch",alignment:"centerY"});u(this,"text");u(this,"image");this.id=e.id,this._setElements(e.image,e.text)}_setElements(e,r){const s="voir-img-ref-"+this.id,i="voir-text-ref-"+this.id;e&&this.append(new o.ImageView({image:e,width:24,left:28,id:s}));const c=e?12:64;this.append(new o.TextView({text:r,font:"20px sans-serif",left:c,id:i}))}}const Ee=I,Me=({children:n},t)=>new o.WidgetCollection(n!=null?n:t),Be=(n,t)=>{console.warn("deprecated function [menuDrawer] use setMenuDrawer"),ee(n,t)};function ue(){const n=k.find("#scrollableLayoutMenuDrawer"),t=n.length!==0?n.first():new o.ScrollView({id:"scrollableLayoutMenuDrawer",top:"prev()",left:0,right:0,bottom:0});return n.length===0&&k.append(t),t}function ee(n,t){ue().append(n.map(e=>{const r=e instanceof I,s=e.id;return r&&(e.id=""),new Z(s).append(r?e:new I({image:e.image,text:e.text})).on("tap",function(){typeof t=="function"&&t(this);const i=setTimeout(()=>(k.close(),clearTimeout(i)),100)})}))}function de(n){const t=ue(),e=k.find("#voirContentDrawer"),r=e.length===0?new o.Composite({top:"prev() 15",left:0,right:0,id:"voirContentDrawer",padding:8}).append(n):e.first().append(n);e.length===0&&t.append(r)}const x=new Map,W=class W extends o.NavigationView{constructor(e){super(e);u(this,"onActionSelected");u(this,"onDrawerItemSelected");u(this,"_renderWidgetInDrawer",(()=>{let e=!1;return()=>{if(e)return;e=!0;const r=()=>{ee(this.menuDrawer),de(this.contentDrawer),this.menuDrawer.forEach(s=>{S.listener(this,s.parent())})};this.drawerActionVisible&&r()}})());this.$actions=[]}set contentDrawer(e){this._contentDrawer=e}get contentDrawer(){var e;return(e=this._contentDrawer)!=null?e:new o.WidgetCollection}set menuDrawer(e){this._dataMenuDrawer=e.toArray()}get menuDrawer(){var e;return(e=this._dataMenuDrawer)!=null?e:[]}on(e,r,s){return typeof e=="string"&&W.events.includes(e)&&S.addListener(this,e,r),super.on(e,r,s)}_addChild(e){S.listener(this,e),e instanceof o.Page&&(x.set(e,{hidden:!1,actions:null,isDisposed:!1}),e.on("appear",()=>{this._renderWidgetInDrawer();const s=x.get(e);typeof s=="object"&&s.hidden&&(s.actions!==null&&this.append(s.actions),s.hidden=!1),x.size===1&&r(!0)}),e.on("disappear",()=>{var i;const s=x.get(e);r(!1),s.hidden||(s.hidden=!0,(i=s.actions)==null||i.forEach(c=>c.detach())),s.isDisposed&&x.delete(e)}),e.on("dispose",()=>{x.get(e).isDisposed=!0}));const r=s=>{this!=null&&this.drawerActionVisible&&(k.enabled=s)};return typeof super._addChild=="function"?super._addChild(e):this}append(...e){const r=super.append(...e);return setTimeout(()=>Te(e),0),r}};u(W,"events",["actionSelected","drawerItemSelected"]);let B=W;function Le(n){const t=n.find(s=>s instanceof o.Page),e=n.filter(s=>s instanceof o.Action||s instanceof o.SearchAction?s.data.voirInitializedEvent=!0:!1),r=x.get(t);return t&&e.length&&r.actions===null&&(r.actions=e),r}function Te(n){let t=n.length>1?n:Array.isArray(n[0])?n.shift():n;if(t.some(e=>Array.isArray(e)))throw new Error("error parameter");if(Array.isArray(t)&&t.length>0)return Le(t)}S(B,{instanceOf:[{element:o.Action,listeners:["select"],invoke:["actionSelected"]},{element:o.SearchAction,listeners:["select"],invoke:["actionSelected"]},{element:Z,listeners:["tap"],invoke:["drawerItemSelected"]}],nameEvents:["actionSelected","drawerItemSelected"]});const je=O(B),L="voir-native-preference";localStorage.getItem(L)||localStorage.setItem(L,"{}");const T=JSON.parse(localStorage.getItem(L)),R=(n,t)=>{T[n]=t,localStorage.setItem(L,JSON.stringify(T))},te=n=>T[n],fe=n=>n in T,A=(n,t,e)=>o.NativeObject.defineProperty(n,t,e),Ie={left:0,right:"10%"},oe=n=>t=>n.on("tap",t),M=class M extends o.Composite{constructor(e){super(m({left:0,right:0,padding:10,top:"prev()",highlightOnTouch:!0},e));u(this,"_customEvent",{});fe(this.key)||R(this.key,this.value);const r=this.summary.length===0?!0:0,s={text:this.title.toCapitalize()};r?s.centerY=p.centerY:s.top="prev()",this.append(new o.TextView(s)),this.summary.length>0&&this.append(new o.TextView(m({text:this.summary,top:["prev()",0]},Ie)))}set onSelect(e){oe(this)(e)}get onSelect(){return oe(this)}on(e,r,s){if(typeof e=="string"&&M.typeEvents.includes(e))this._customEvent[e]=r;else if(e instanceof Object)for(let i in e)M.typeEvents.includes(i)&&(this._customEvent[i]=e[i]);return super.on(e,r,s)}};u(M,"typeEvents",["select"]);let y=M;A(y.prototype,"title",{type:"string",default:""});A(y.prototype,"summary",{type:"string",default:""});A(y.prototype,"key",{type:"string",default:""});A(y.prototype,"value",{type:"string",default:""});class Y extends y{constructor(t){var r;let e;t.onSelect=()=>e&&(e.checked=!e.checked),super(t),e=this._getButton({right:0,centerY:p.centerY,checked:(r=te(this.key))!=null?r:this.value}),typeof e!="undefined"&&(this.addListener(e),this.append(e))}addListener(t){t.on("checkedChanged",e=>{R(this.key,t.checked),typeof this._customEvent.select=="function"&&this._customEvent.select.call(this,e)})}_getButton(t){throw new Error("implements method")}}class he extends Y{constructor(t){super(t)}_getButton(t){return new o.CheckBox(t)}}const We=O(he);class pe extends Y{constructor(t){super(t)}_getButton(t){return new o.Switch(t)}}const Re=O(pe);class ge extends y{constructor(t){super(t)}}const Ye=O(ge);class me extends o.Page{constructor(t={}){super(V(m({},t),{layoutData:p.stretch}))}}const ze=O(me);class z extends Y{_getButton(){}constructor(t){super(t),this.onSelect(()=>{const r=new ce({title:this.title.toCapitalize()});this.entries&&this.entries.length>0&&r.addView(...this.entries.map((s,i)=>{var h;const c=new o.RadioButton({text:s.text,checked:(h=s.checked)!=null?h:parseInt(te(this.key))===i,top:"prev() 5",left:0,right:0}).onSelect(v=>{v.checked&&(R(this.key,i),typeof this._customEvent.select=="function"&&this._customEvent.select.call(this,v))});return s.id&&(c.id=s.id),c})),r.setButtonAccept(this.textButtonAccept.toUpperCase()).addListener(e.bind(r)),r.show()});function e(){this.remove()}}}const Xe=O(z);A(z.prototype,"entries",{type:"any",default:[]});A(z.prototype,"textButtonAccept",{type:"string",default:"accept"});let q;try{w.on("addChild",({child:n})=>{n instanceof o.NavigationView&&!q&&(q=n)})}catch(n){console.log(n)}function we(...n){return q.append(...n)}class He{constructor(){const t=[];if(typeof this.renderAction=="function"){const e=this.renderAction();e&&t.push(...Array.from(e))}we(...t,this.render())}}const Ne=Object.freeze({Render:He,factory(n){return De(n)}});exports.$preference=T;exports.AbstractItemPreference=y;exports.Action=ke;exports.AnimationTime=E;exports.CheckBoxPreference=We;exports.CheckBoxPreferenceComponent=he;exports.Checked=Y;exports.CoordinatePage=je;exports.CoordinatePageComponent=B;exports.DrawerMenu=Me;exports.DrawerMenuItem=Ee;exports.LayoutData=Oe;exports.ListPreference=Xe;exports.ListPreferenceComponent=z;exports.Listeners=G;exports.MenuAction=Z;exports.MenuItem=I;exports.Modal=ce;exports.PreferenceScreen=ze;exports.PreferenceScreenComponent=me;exports.Row=ie;exports.SwitchPreference=Re;exports.SwitchPreferenceComponent=pe;exports.TextPreference=Ye;exports.TextPreferenceComponent=ge;exports.Toast=j;exports.Voir=Ne;exports.addView=we;exports.animate=ae;exports.animateHidden=Q;exports.animateShow=F;exports.contentView=w;exports.drawer=k;exports.existsKeyPreference=fe;exports.getValuePreference=te;exports.isVersion2=f;exports.layoutData=p;exports.menuDrawer=Be;exports.name_key_pref=L;exports.navigationBar=Se;exports.setContentDrawer=de;exports.setMenuDrawer=ee;exports.setPreference=R;exports.statusBar=_e;exports.stretch=J;exports.stretchX=U;exports.stretchY=K;
